<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Siap Antar, Siap Jemput & Siap Suruh</title>

  <!-- Leaflet CSS & JS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <!-- Leaflet-Geosearch -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet-geosearch@3.3.0/dist/geosearch.css"/>
  <script src="https://unpkg.com/leaflet-geosearch@3.3.0/dist/bundle.min.js"></script>

  <style>
    body { background-color: #f8f9fa; font-family: 'Segoe UI', sans-serif; margin: 0; padding-bottom: 90px; }
    header { background-color: #28a745; color: white; padding: 12px 15px; display:flex; align-items:center; justify-content:space-between; font-weight:bold; border-bottom:4px solid #ff7f00; }
    header h4 { margin:0; font-size: 16px; }

    .banner img { width:100%; border-radius:10px; display:block; margin-top:10px; }

    .kategori-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:15px; margin:20px; }
    .kategori-item { background:white; border-radius:15px; box-shadow:0 2px 4px rgba(0,0,0,0.1); padding:15px; text-align:center; transition:transform .2s; cursor:pointer; }
    .kategori-item:hover { transform:scale(1.05); }
    .kategori-item img { width:55px; height:55px; margin-bottom:8px; }
    .kategori-item span { font-size:13px; font-weight:600; color:#333; }

    .popup { display:none; position:fixed; z-index:999; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.6); justify-content:center; align-items:center; }
    .popup-content { background:#fff; border-radius:15px; width:95%; max-width:520px; max-height:92vh; overflow-y:auto; padding:18px; position:relative; box-shadow:0 4px 15px rgba(0,0,0,0.3); }
    .close { position:absolute; right:15px; top:10px; font-size:22px; cursor:pointer; color:#555; }

    label { font-weight:600; font-size:13px; display:block; margin-top:8px; }
    input, select, textarea, button { width:100%; padding:10px; margin-top:6px; border-radius:8px; border:1px solid #ccc; font-size:14px; box-sizing:border-box; }
    button { background:#ff7f00; color:#fff; border:none; font-weight:700; cursor:pointer; }
    button.small { width:auto; padding:8px 12px; border-radius:8px; display:inline-block; margin-right:8px; }

    /* map modal */
    #mapModal { display:none; position:fixed; z-index:1100; inset:0; background:rgba(0,0,0,0.6); justify-content:center; align-items:center; }
    #mapModal .content { background:#fff; width:95%; max-width:900px; max-height:92vh; border-radius:12px; padding:12px; overflow:hidden; display:flex; flex-direction:column; }
    #map { height:420px; border-radius:8px; }
    .map-controls { display:flex; gap:8px; align-items:center; margin-bottom:8px; flex-wrap:wrap; }
    .map-controls input { flex:1; min-width:160px; }

    .info-line { font-size:14px; margin-top:6px; }

    .toast { visibility:hidden; min-width:250px; background:#333; color:#fff; text-align:center; border-radius:25px; padding:12px; position:fixed; z-index:1200; left:50%; bottom:90px; transform:translateX(-50%); font-size:14px; opacity:0; transition:opacity .5s, bottom .5s; }
    .toast.show { visibility:visible; opacity:1; bottom:100px; }

    .bottom-nav { position:fixed; bottom:0; left:0; right:0; background:#fff; border-top:1px solid #ddd; display:flex; justify-content:space-around; padding:8px 0; box-shadow:0 -2px 5px rgba(0,0,0,0.1); }
    .bottom-nav a { text-decoration:none; color:#28a745; font-size:22px; display:flex; flex-direction:column; align-items:center; }
    .bottom-nav span { font-size:12px; color:#333; }
  </style>
</head>
<body>
  <header><h4>Siap Antar, Siap Jemput & Siap Suruh</h4></header>

  <div class="banner">
    <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhRChNVFEnMamg4xeg_J9Fkr_3I93wxxk4o6XlG1z8FMwSPS0mlpsb2yPdXa3zdSM5edvwKiUfp36e8LbDary6mH6uUOTVCSsaT5beEW9Qly3xn7CIaToNsZa63wsUHP5q9hjmrG-QhLHN066qercKNZu2ATqe__2R87rdTm4EiWR19DcsFuIddMjyY0bI/s1536/IMG_20251005_083246.png" alt="banner"></div>

  <div class="kategori-grid">
    <div class="kategori-item" onclick="bukaForm('Antar Jemput')">
      <img src="https://cdn-icons-png.flaticon.com/512/1995/1995470.png"><span>Antar Jemput</span>
    </div>
    <div class="kategori-item" onclick="bukaForm('Kirim Paket')">
      <img src="https://cdn-icons-png.flaticon.com/512/679/679922.png"><span>Kirim Paket</span>
    </div>
    <div class="kategori-item" onclick="bukaForm('Bersih Rumah')">
      <img src="https://cdn-icons-png.flaticon.com/512/883/883407.png"><span>Bersih Rumah</span>
    </div>
    <div class="kategori-item" onclick="bukaForm('Bersihin Kebun')">
      <img src="https://cdn-icons-png.flaticon.com/512/482/482988.png"><span>Bersihin Kebun</span>
    </div>
    <div class="kategori-item" onclick="bukaForm('Tambal Ban')">
      <img src="https://cdn-icons-png.flaticon.com/512/3430/3430871.png"><span>Tambal Ban</span>
    </div>
    <div class="kategori-item" onclick="bukaForm('Tukang')">
      <img src="https://cdn-icons-png.flaticon.com/512/272/272075.png"><span>Tukang</span>
    </div>
    <div class="kategori-item" onclick="bukaForm('Jaga Rumah')">
      <img src="https://cdn-icons-png.flaticon.com/512/484/484582.png"><span>Jaga Rumah</span>
    </div>
  </div>

  <!-- MAIN FORM POPUP -->
  <div id="popupForm" class="popup">
    <div class="popup-content">
      <span class="close" onclick="tutupForm()">&times;</span>
      <h3 id="judulForm">Form Pesanan</h3>

      <label>Nama Lengkap</label>
      <input type="text" id="nama" placeholder="Nama Lengkap">

      <label>Alamat / Catatan singkat</label>
      <input type="text" id="alamatDetail" placeholder="Misal: Depan rumah, gang kecil...">

      <label>Lokasi Jemput (klik tombol untuk buka peta)</label>
      <div style="display:flex; gap:8px; align-items:center;">
        <button class="small" onclick="bukaMapModal('jemput')">Tentukan Lokasi</button>
        <button class="small" onclick="setMarkerToCurrentModeFromForm('jemput')" style="background:#28a745">Gunakan Lokasi Saya</button>
        <input type="text" id="lokasiJemput" placeholder="Link lokasi jemput (otomatis terisi)" readonly>
      </div>

      <div id="tujuanGroup" style="margin-top:8px; display:none;">
        <label>Lokasi Antar / Tujuan</label>
        <div style="display:flex; gap:8px; align-items:center;">
          <button class="small" onclick="bukaMapModal('antar')">Tentukan Tujuan</button>
          <button class="small" onclick="setMarkerToCurrentModeFromForm('antar')" style="background:#dc3545">Gunakan Lokasi Saya</button>
          <input type="text" id="lokasiAntar" placeholder="Link lokasi tujuan (otomatis terisi)" readonly>
        </div>
      </div>

      <label>Koordinat Jemput</label>
      <input type="text" id="coordJemput" placeholder="lat,lon" readonly>

      <label id="labelCoordAntar" style="display:none;">Koordinat Tujuan</label>
      <input type="text" id="coordAntar" placeholder="lat,lon" readonly style="display:none;">

      <div id="estimasiGroup" style="display:none; margin-top:8px;">
        <label>Jarak (km)</label>
        <input type="text" id="jarak" readonly placeholder="-">
        <label>Estimasi Biaya</label>
        <input type="text" id="estimasiBiaya" readonly placeholder="-">
        <button class="small" onclick="hitungJarakDariForm()">Hitung Ulang Estimasi</button>
      </div>

      <label>Pertanyaan Biaya / Harga</label>
      <textarea id="pertanyaanBiaya" placeholder="Contoh: Berapa biaya per jam?"></textarea>

      <label>Metode Bayar</label>
      <select id="metodeBayar">
        <option value="CASH DRIVER">CASH DRIVER</option>
        <option value="TRANSFER">TRANSFER</option>
        <option value="QRIS">QRIS</option>
      </select>

      <label>Catatan Tambahan</label>
      <textarea id="catatan" placeholder="Catatan tambahan (opsional)"></textarea>

      <button onclick="kirimPesanan()">Kirim Pesanan</button>
    </div>
  </div>

  <!-- SHARED MAP MODAL -->
  <div id="mapModal" style="display:none; align-items:center;">
    <div class="content">
      <div style="display:flex; justify-content:space-between; align-items:center; gap:8px; margin-bottom:8px;">
        <div style="flex:1;">
          <div class="map-controls">
            <input type="text" id="searchJemput" placeholder="Cari lokasi jemput... (Enter)" />
            <input type="text" id="searchAntar" placeholder="Cari lokasi antar... (Enter)" />
            <div style="display:flex; gap:8px; align-items:center;">
              <label style="font-size:13px;">Mode:</label>
              <select id="mapMode">
                <option value="jemput">Set Titik Jemput</option>
                <option value="antar">Set Titik Antar</option>
              </select>
            </div>
          </div>
        </div>
        <div style="display:flex; gap:6px;">
          <button class="small" onclick="setMarkerToCurrentMode()">Gunakan Lokasi Ini</button>
          <button class="small" onclick="tutupMapModal()" style="background:#6c757d">Selesai</button>
        </div>
      </div>

      <div id="map"></div>

      <div style="display:flex; gap:8px; margin-top:8px; align-items:center; flex-wrap:wrap;">
        <div class="info-line"><b>Jemput:</b> <span id="infoJemput">-</span></div>
        <div class="info-line"><b>Antar:</b> <span id="infoAntar">-</span></div>
        <div class="info-line" id="infoJarakLine" style="display:none;"><b>Jarak:</b> <span id="infoJarak">-</span> km</div>
        <div class="info-line" id="infoBiayaLine" style="display:none;"><b>Estimasi:</b> <span id="infoBiaya">-</span></div>
      </div>
    </div>
  </div>

  <div id="toast" class="toast">‚úÖ Pesanan dikirim ke Admin</div>

  <nav class="bottom-nav">
    <a href="#" onclick="scrollTo(0,0)">üè†<span>Home</span></a>
    <a href="https://wa.me/6281262433533?text=Halo%20Admin%2C%20saya%20ingin%20cek%20pesanan.">üì¶<span>Pesanan</span></a>
    <a href="https://wa.me/6281262433533?text=Halo%20Admin%2C%20saya%20butuh%20bantuan.">üí¨<span>Chat</span></a>
  </nav>

  <script>
    // globals
    let layananDipilih = "";
    let map = null, markerJemput = null, markerAntar = null;
    let latJemput = null, lonJemput = null, latAntar = null, lonAntar = null;
    let provider = null;

    // banner rotate (single image ok)
    const slides = document.querySelectorAll('.banner img');
    if (slides.length > 0) {
      let slideIndex = 0;
      setInterval(() => {
        slides.forEach(s => s.classList.remove('active'));
        slides[slideIndex].classList.add('active');
        slideIndex = (slideIndex + 1) % slides.length;
      }, 3000);
    }

    /* FORM open/close */
    function bukaForm(layanan) {
      layananDipilih = layanan;
      document.getElementById("judulForm").innerText = layanan;
      document.getElementById("popupForm").style.display = "flex";

      // reset form fields (except nama optionally)
      document.getElementById("alamatDetail").value = "";
      document.getElementById("lokasiJemput").value = "";
      document.getElementById("lokasiAntar").value = "";
      document.getElementById("coordJemput").value = "";
      document.getElementById("coordAntar").value = "";
      document.getElementById("jarak").value = "";
      document.getElementById("estimasiBiaya").value = "";
      document.getElementById("pertanyaanBiaya").value = "";
      document.getElementById("catatan").value = "";

      if (layanan === "Antar Jemput" || layanan === "Kirim Paket") {
        document.getElementById("tujuanGroup").style.display = "block";
        document.getElementById("labelCoordAntar").style.display = "block";
        document.getElementById("coordAntar").style.display = "block";
        document.getElementById("estimasiGroup").style.display = "block";
      } else {
        document.getElementById("tujuanGroup").style.display = "none";
        document.getElementById("labelCoordAntar").style.display = "none";
        document.getElementById("coordAntar").style.display = "none";
        document.getElementById("estimasiGroup").style.display = "none";
      }
    }
    function tutupForm() { document.getElementById("popupForm").style.display = "none"; }

    /* MAP initialisation (lazy but robust) */
    function initSharedMap() {
      if (map) return;
      // create map
      map = L.map('map', { center:[-6.200000, 106.816666], zoom:12 });
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution:'Data ¬© OpenStreetMap contributors' }).addTo(map);

      // provider for search
      try { provider = new window.GeoSearch.OpenStreetMapProvider(); } catch(e){ provider = null; console.warn('Geosearch provider not available', e); }

      // markers not yet added to map; create with draggable true
      markerJemput = L.marker([0,0], { draggable:true, icon: greenIcon() });
      markerAntar = L.marker([0,0], { draggable:true, icon: redIcon() });

      // drag events
      markerJemput.on('dragend', function(e){ const p = e.target.getLatLng(); setJemputCoords(p.lat, p.lng); updateSummaryInfo(); });
      markerAntar.on('dragend', function(e){ const p = e.target.getLatLng(); setAntarCoords(p.lat, p.lng); updateSummaryInfo(); });

      // map click: place marker based on current mode
      map.on('click', function(e){
        const mode = document.getElementById("mapMode").value || 'jemput';
        if (mode === 'jemput') placeJemput(e.latlng.lat, e.latlng.lng, true);
        else placeAntar(e.latlng.lat, e.latlng.lng, true);
      });

      // search inputs: Enter -> perform search
      document.getElementById("searchJemput").addEventListener('keydown', function(ev){
        if (ev.key === 'Enter') { ev.preventDefault(); doSearchAndPlace('jemput'); }
      });
      document.getElementById("searchAntar").addEventListener('keydown', function(ev){
        if (ev.key === 'Enter') { ev.preventDefault(); doSearchAndPlace('antar'); }
      });
    }

    function doSearchAndPlace(mode) {
      if (!provider) return alert('Fitur pencarian belum tersedia.');
      const q = (mode === 'jemput') ? document.getElementById("searchJemput").value : document.getElementById("searchAntar").value;
      if (!q) return alert('Tulis alamat lalu tekan Enter.');
      provider.search({ query: q }).then(results=>{
        if (results && results.length>0) {
          const r = results[0];
          // r.x = lon, r.y = lat
          map.setView([r.y, r.x], 16);
          if (mode === 'jemput') placeJemput(r.y, r.x, true);
          else placeAntar(r.y, r.x, true);
        } else alert('Lokasi tidak ditemukan. Coba kata kunci lain.');
      }).catch(err => {
        console.error(err);
        alert('Gagal mencari alamat. Coba lagi.');
      });
    }

    // icons
    function greenIcon(){ return L.icon({ iconUrl: 'https://cdn-icons-png.flaticon.com/512/484/484167.png', iconSize:[34,34], iconAnchor:[17,34] }); }
    function redIcon(){ return L.icon({ iconUrl:'https://cdn-icons-png.flaticon.com/512/484/484662.png', iconSize:[34,34], iconAnchor:[17,34] }); }

    function placeJemput(lat, lon, openPopup=false) {
      latJemput = lat; lonJemput = lon;
      markerJemput.setLatLng([lat, lon]);
      if (!map.hasLayer(markerJemput)) markerJemput.addTo(map);
      if (openPopup) markerJemput.bindPopup('Titik Jemput').openPopup();
      setJemputCoords(lat, lon);
      fitMapToMarkers();
      updateSummaryInfo();
    }
    function placeAntar(lat, lon, openPopup=false) {
      latAntar = lat; lonAntar = lon;
      markerAntar.setLatLng([lat, lon]);
      if (!map.hasLayer(markerAntar)) markerAntar.addTo(map);
      if (openPopup) markerAntar.bindPopup('Titik Antar/Tujuan').openPopup();
      setAntarCoords(lat, lon);
      fitMapToMarkers();
      updateSummaryInfo();
    }

    function setJemputCoords(lat, lon) {
      document.getElementById("lokasiJemput").value = `https://www.google.com/maps?q=${lat},${lon}`;
      document.getElementById("coordJemput").value = `${lat.toFixed(6)},${lon.toFixed(6)}`;
    }
    function setAntarCoords(lat, lon) {
      document.getElementById("lokasiAntar").value = `https://www.google.com/maps?q=${lat},${lon}`;
      document.getElementById("coordAntar").value = `${lat.toFixed(6)},${lon.toFixed(6)}`;
    }

    function fitMapToMarkers() {
      const latlngs = [];
      if (markerJemput && map.hasLayer(markerJemput)) latlngs.push(markerJemput.getLatLng());
      if (markerAntar && map.hasLayer(markerAntar)) latlngs.push(markerAntar.getLatLng());
      if (latlngs.length === 0) return;
      if (latlngs.length === 1) map.setView(latlngs[0], 15);
      else {
        const group = L.featureGroup([markerJemput, markerAntar].filter(m=>map.hasLayer(m)));
        map.fitBounds(group.getBounds().pad(0.2));
      }
    }

    function updateSummaryInfo() {
      document.getElementById("infoJemput").innerText = latJemput ? `${latJemput.toFixed(6)}, ${lonJemput.toFixed(6)}` : '-';
      document.getElementById("infoAntar").innerText = latAntar ? `${latAntar.toFixed(6)}, ${lonAntar.toFixed(6)}` : '-';
      if (latJemput && latAntar) {
        const jarak = haversine(latJemput, lonJemput, latAntar, lonAntar);
        const jarakRounded = parseFloat(jarak.toFixed(2));
        const biayaAwal = jarakRounded * 4000;
        const sisa = biayaAwal % 1000;
        let biaya = sisa > 500 ? biayaAwal + (1000 - sisa) : biayaAwal - sisa;
        biaya = Math.max(1000, Math.round(biaya));
        document.getElementById("infoJarak").innerText = jarakRounded;
        document.getElementById("infoBiaya").innerText = "Rp " + biaya.toLocaleString("id-ID");
        document.getElementById("infoJarakLine").style.display = 'inline-block';
        document.getElementById("infoBiayaLine").style.display = 'inline-block';
        document.getElementById("jarak").value = jarakRounded;
        document.getElementById("estimasiBiaya").value = "Rp " + biaya.toLocaleString("id-ID");
      } else {
        document.getElementById("infoJarak").innerText = '-';
        document.getElementById("infoBiaya").innerText = '-';
        document.getElementById("infoJarakLine").style.display = 'none';
        document.getElementById("infoBiayaLine").style.display = 'none';
      }
    }

    function haversine(lat1, lon1, lat2, lon2) {
      const R = 6371;
      const dLat = (lat2 - lat1) * Math.PI / 180;
      const dLon = (lon2 - lon1) * Math.PI / 180;
      const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)**2;
      return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    }

    // --- GEOLOCATION helpers with clear error handling ---
    function requestGeolocation(success, failure) {
      if (!navigator.geolocation) {
        alert('Browser Anda tidak mendukung geolokasi.');
        if (failure) failure({ code: 0, message: 'geolocation not supported' });
        return;
      }
      // optional: try check permissions (fallback if not available)
      navigator.geolocation.getCurrentPosition(success, function(err) {
        console.warn('geolocation error', err);
        if (err.code === 1) alert('Izin lokasi ditolak. Aktifkan izin lokasi untuk situs ini di Settings / Setelan situs.');
        else if (err.code === 2) alert('Lokasi tidak tersedia.');
        else if (err.code === 3) alert('Permintaan lokasi timeout. Coba lagi.');
        else alert('Gagal mengambil lokasi: ' + (err.message || 'unknown'));
        if (failure) failure(err);
      }, { enableHighAccuracy:true, timeout:10000, maximumAge:0 });
    }

    // called by "Gunakan Lokasi Ini" inside map modal
    function setMarkerToCurrentMode() {
      initSharedMap();
      requestGeolocation(function(pos){
        const lat = pos.coords.latitude, lon = pos.coords.longitude;
        const mode = document.getElementById("mapMode").value || 'jemput';
        if (mode === 'jemput') placeJemput(lat, lon, true);
        else placeAntar(lat, lon, true);
        // ensure map redraw
        setTimeout(()=>{ map.invalidateSize(); fitMapToMarkers(); }, 200);
      }, function(){});
    }

    // called by small "Gunakan Lokasi Saya" buttons in main form (close-form flow)
    function setMarkerToCurrentModeFromForm(mode) {
      // open/ensure map is initialized but we don't show modal; we place marker directly
      initSharedMap();
      requestGeolocation(function(pos){
        const lat = pos.coords.latitude, lon = pos.coords.longitude;
        if (mode === 'jemput') {
          placeJemput(lat, lon, true);
        } else {
          placeAntar(lat, lon, true);
        }
        // reflect in main popup fields
        updateSummaryInfo();
      }, function(){});
    }

    // open shared modal (modeWanted optional)
    function bukaMapModal(modeWanted) {
      document.getElementById("mapModal").style.display = "flex";
      if (modeWanted === 'jemput') document.getElementById("mapMode").value = 'jemput';
      if (modeWanted === 'antar') document.getElementById("mapMode").value = 'antar';
      initSharedMap();
      // when modal visible, Leaflet needs invalidateSize()
      setTimeout(()=>{ try{ map.invalidateSize(); fitMapToMarkers(); }catch(e){console.warn(e);} }, 250);
    }

    function tutupMapModal() {
      document.getElementById("mapModal").style.display = "none";
      // update main form info after closing
      updateSummaryInfo();
      // toggle visibility fields for antar group (already handled in bukaForm)
    }

    // helper for "Gunakan Lokasi Ini" in popup form (opens modal first)
    function setMarkerToCurrentModeFromPopup(mode) {
      bukaMapModal(mode);
      setTimeout(()=>{ setMarkerToCurrentMode(); }, 450);
    }

    // allow pressing outside modal to close
    document.getElementById('mapModal').addEventListener('click', function(e){
      if (e.target === this) { tutupMapModal(); }
    });
    document.getElementById('popupForm').addEventListener('click', function(e){
      if (e.target === this) tutupForm();
    });

    // recompute from main form
    function hitungJarakDariForm() {
      if (!latJemput || !latAntar) return alert('Tentukan jemput dan antar terlebih dahulu.');
      updateSummaryInfo();
      alert('Estimasi diperbarui.');
    }

    // SEND ORDER
    function kirimPesanan() {
      const nama = document.getElementById("nama").value.trim();
      const alamatDetail = document.getElementById("alamatDetail").value.trim();
      const lokasiJemput = document.getElementById("lokasiJemput").value;
      const lokasiAntar = document.getElementById("lokasiAntar").value;
      const coordJemputVal = document.getElementById("coordJemput").value;
      const coordAntarVal = document.getElementById("coordAntar").value;
      const jarakVal = document.getElementById("jarak").value;
      const estimasiVal = document.getElementById("estimasiBiaya").value;
      const pertanyaan = document.getElementById("pertanyaanBiaya").value.trim();
      const metode = document.getElementById("metodeBayar").value;
      const catatan = document.getElementById("catatan").value.trim();

      if (!nama) return alert('Isi nama lengkap!');
      if (!lokasiJemput) return alert('Tentukan lokasi jemput terlebih dahulu.');

      let pesan = `üßæ *Pesanan ${layananDipilih}*%0Aüë§ Nama: ${nama}%0Aüìç Alamat singkat: ${encodeURIComponent(alamatDetail)}%0A`;
      pesan += `üìç Lokasi Jemput: ${lokasiJemput}%0Aüî¢ Koordinat Jemput: ${coordJemputVal}%0A`;

      if (layananDipilih === 'Antar Jemput' || layananDipilih === 'Kirim Paket') {
        if (!lokasiAntar) return alert('Tentukan lokasi tujuan (antar) terlebih dahulu.');
        pesan += `üéØ Lokasi Antar: ${lokasiAntar}%0Aüî¢ Koordinat Antar: ${coordAntarVal}%0Aüìè Jarak: ${jarakVal} km%0Aüí∞ Estimasi: ${estimasiVal}%0A`;
      }

      if (pertanyaan) pesan += `‚ùì Pertanyaan Biaya: ${encodeURIComponent(pertanyaan)}%0A`;
      pesan += `üí≥ Pembayaran: ${metode}%0Aüìù Catatan: ${encodeURIComponent(catatan)}`;

      window.open(`https://wa.me/6281262433533?text=${pesan}`, '_blank');
      showToast();
      setTimeout(()=>{ tutupForm(); }, 800);
    }

    function showToast() {
      const t = document.getElementById('toast');
      t.classList.add('show');
      setTimeout(()=> t.classList.remove('show'), 2800);
    }

    // optional: init map on load to reduce first open delay (comment/uncomment as needed)
    // window.addEventListener('load', initSharedMap);
  </script>
</body>
</html>
