<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Siap Antar, Siap Jemput & Siap Suruh</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #f5f5f5;
    }

    header {
      background: linear-gradient(45deg, #009688, #ff9800);
      color: white;
      padding: 15px;
      text-align: center;
      font-weight: bold;
      font-size: 20px;
    }

    .container {
      padding: 10px;
    }

    .menu-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 10px;
    }

    .menu-item {
      background: white;
      border-radius: 10px;
      text-align: center;
      padding: 10px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      cursor: pointer;
    }

    .menu-item img {
      width: 60px;
      height: 60px;
      margin-bottom: 5px;
    }

    .menu-item span {
      display: block;
      font-size: 14px;
      color: #333;
    }

    /* Popup */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow-y: auto;
      background: rgba(0,0,0,0.5);
    }

    .modal-content {
      background: white;
      margin: 50px auto;
      border-radius: 10px;
      padding: 15px;
      width: 90%;
      max-width: 400px;
    }

    .close {
      float: right;
      font-size: 20px;
      cursor: pointer;
    }

    label {
      font-weight: bold;
      font-size: 14px;
    }

    input, select, textarea {
      width: 100%;
      margin-top: 5px;
      margin-bottom: 10px;
      padding: 8px;
      border-radius: 5px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }

    button {
      width: 100%;
      padding: 10px;
      border: none;
      border-radius: 8px;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }

    .btn-lokasi {
      background: #ff9800;
    }

    .btn-kirim {
      background: #009688;
      margin-top: 10px;
    }

    #map {
      width: 100%;
      height: 200px;
      border-radius: 10px;
      margin-top: 10px;
    }

    /* Bottom Navigation */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      border-top: 1px solid #ccc;
      display: flex;
      justify-content: space-around;
      padding: 10px 0;
      box-shadow: 0 -2px 5px rgba(0,0,0,0.1);
    }

    .bottom-nav a {
      text-decoration: none;
      color: #555;
      font-size: 14px;
      font-weight: 500;
    }

    .bottom-nav a:hover {
      color: #009688;
    }
  </style>
</head>
<body>
  <header>Siap Antar, Siap Jemput & Siap Suruh</header>

  <div class="container">
    <div class="menu-grid">
      <div class="menu-item" onclick="openForm('Antar Jemput', true)">
        <img src="https://cdn-icons-png.flaticon.com/512/3039/3039395.png" alt="">
        <span>Antar Jemput</span>
      </div>
      <div class="menu-item" onclick="openForm('Kirim Paket', true)">
        <img src="https://cdn-icons-png.flaticon.com/512/714/714390.png" alt="">
        <span>Kirim Paket</span>
      </div>
      <div class="menu-item" onclick="openForm('Bersih Rumah', false)">
        <img src="https://cdn-icons-png.flaticon.com/512/1048/1048945.png" alt="">
        <span>Bersih Rumah</span>
      </div>
      <div class="menu-item" onclick="openForm('Bersihin Kebun', false)">
        <img src="https://cdn-icons-png.flaticon.com/512/3176/3176362.png" alt="">
        <span>Bersihin Kebun</span>
      </div>
      <div class="menu-item" onclick="openForm('Tambal Ban', false)">
        <img src="https://cdn-icons-png.flaticon.com/512/3069/3069170.png" alt="">
        <span>Tambal Ban</span>
      </div>
      <div class="menu-item" onclick="openForm('Tukang', false)">
        <img src="https://cdn-icons-png.flaticon.com/512/3199/3199958.png" alt="">
        <span>Tukang</span>
      </div>
      <div class="menu-item" onclick="openForm('Jaga Rumah', false)">
        <img src="https://cdn-icons-png.flaticon.com/512/1067/1067566.png" alt="">
        <span>Jaga Rumah</span>
      </div>
    </div>
  </div>

  <!-- Popup Form -->
  <div id="popupForm" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeForm()">&times;</span>
      <h3 id="formTitle">Pesanan</h3>

      <label>Nama:</label>
      <input id="nama" placeholder="Nama Anda">

      <label>Jasa yang dipilih:</label>
      <input id="jenisJasa" readonly>

      <label>Titik Jemput:</label>
      <input id="titikJemput" readonly>
      <button class="btn-lokasi" onclick="setLokasi('jemput')">üìç Set Lokasi Jemput</button>

      <label>Alamat Tujuan:</label>
      <input id="titikTujuan" placeholder="Masukkan alamat tujuan">
      <button class="btn-lokasi" onclick="setLokasi('tujuan')">üéØ Set Lokasi Tujuan</button>

      <div id="map"></div>

      <div id="fieldJarak" style="display:none;">
        <label>Estimasi Biaya Otomatis:</label>
        <input id="estimasiBiaya" readonly placeholder="Estimasi akan muncul otomatis">
      </div>

      <div id="fieldNego" style="display:none;">
        <label>Pertanyaan atau kebutuhan jasa:</label>
        <textarea id="pertanyaan" placeholder="Tulis kebutuhan jasa Anda..."></textarea>
      </div>

      <label>Metode Bayar:</label>
      <select id="metodeBayar">
        <option>CASH DRIVER</option>
        <option>TRANSFER</option>
        <option>QRIS</option>
      </select>

      <button class="btn-kirim" onclick="kirimPesanan()">Kirim Pesanan</button>
    </div>
  </div>

  <!-- Bottom Navigation -->
  <div class="bottom-nav">
    <a href="#">üè† Home</a>
    <a href="#" onclick="openForm('Pesanan Saya', false)">üìã Pesanan</a>
    <a href="https://wa.me/6281262433533" target="_blank">üí¨ Chat Admin</a>
  </div>

  <script>
    let isOtomatis = false;
    let origin = null;
    let destination = null;
    let map;
    let marker;
    let service;
    const hargaPerKm = 4000;

    function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: -0.7893, lng: 113.9213 },
        zoom: 5,
      });
      service = new google.maps.DistanceMatrixService();
    }

    function openForm(jasa, otomatis) {
      document.getElementById("popupForm").style.display = "block";
      document.getElementById("formTitle").innerText = jasa;
      document.getElementById("jenisJasa").value = jasa;
      isOtomatis = otomatis;
      document.getElementById("fieldJarak").style.display = otomatis ? "block" : "none";
      document.getElementById("fieldNego").style.display = otomatis ? "none" : "block";
    }

    function closeForm() {
      document.getElementById("popupForm").style.display = "none";
    }

    function setLokasi(type) {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function (pos) {
          const lat = pos.coords.latitude;
          const lng = pos.coords.longitude;
          const url = `https://www.google.com/maps?q=${lat},${lng}`;

          if (type === "jemput") {
            document.getElementById("titikJemput").value = url;
            origin = new google.maps.LatLng(lat, lng);
          } else {
            document.getElementById("titikTujuan").value = url;
            destination = new google.maps.LatLng(lat, lng);
          }

          map.setCenter({ lat, lng });
          map.setZoom(15);
          if (marker) marker.setMap(null);
          marker = new google.maps.Marker({ position: { lat, lng }, map });

          if (isOtomatis && origin && destination) {
            hitungJarakDanBiaya();
          }
        });
      } else {
        alert("Browser tidak mendukung geolokasi");
      }
    }

    function hitungJarakDanBiaya() {
      if (!origin || !destination) return;

      service.getDistanceMatrix(
        {
          origins: [origin],
          destinations: [destination],
          travelMode: google.maps.TravelMode.DRIVING,
        },
        function (response, status) {
          if (status === "OK") {
            const distanceValue = response.rows[0].elements[0].distance.value / 1000;
            let biaya = distanceValue * hargaPerKm;

            const sisa = biaya % 1000;
            if (sisa >= 500) biaya += 1000 - sisa;
            else biaya -= sisa;

            document.getElementById("estimasiBiaya").value = "Rp " + biaya.toLocaleString("id-ID");
            document.getElementById("estimasiBiaya").dataset.value = biaya;
          }
        }
      );
    }

    function kirimPesanan() {
      const nama = document.getElementById("nama").value;
      const jasa = document.getElementById("jenisJasa").value;
      const jemput = document.getElementById("titikJemput").value;
      const tujuan = document.getElementById("titikTujuan").value;
      const metode = document.getElementById("metodeBayar").value;
      const biaya = document.getElementById("estimasiBiaya").dataset.value || "";
      const pertanyaan = document.getElementById("pertanyaan").value;

      let pesan = "";

      if (isOtomatis) {
        pesan = `Halo Admin, saya *${nama}* ingin memesan jasa *${jasa}*.
üìç Jemput: ${jemput}
üéØ Tujuan: ${tujuan}
üí∞ Estimasi Biaya: Rp ${parseInt(biaya).toLocaleString("id-ID")}
üí≥ Metode Bayar: ${metode}`;
      } else {
        pesan = `Halo Admin, saya *${nama}* ingin menanyakan harga untuk jasa *${jasa}*.
üìù Keterangan: ${pertanyaan}
üìç Lokasi: ${jemput}`;
      }

      const url = `https://wa.me/6281262433533?text=${encodeURIComponent(pesan)}`;
      window.open(url, "_blank");
    }
  </script>

  <script async
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDH5Jbl6_m6nHshJEyE1QRspbfZ4Mjbxwg&callback=initMap">
  </script>
</body>
</html>
